{"ast":null,"code":"import Cors from \"cors\";\n\nconst init = middleware => {\n  return (req, res) => new Promise((resolve, reject) => {\n    middleware(req, res, result => {\n      if (result instanceof Error) {\n        return reject(result);\n      }\n\n      return resolve(result);\n    });\n  });\n};\n\nconst cors = init(Cors({\n  methods: [\"GET\", \"POST\", \"OPTIONS\"]\n}));\n\nasync function posts(req, res) {\n  await cors(req, res);\n  const {\n    page = 1,\n    slug = null\n  } = req.query;\n  let op = null;\n  let value = null;\n\n  if (slug) {\n    op = \"slug\";\n    value = slug;\n  } else {\n    op = \"page\";\n    value = page;\n  }\n\n  const baseUrl = \"https://www.diogocezar.com/wp-json/wp/v2/posts\";\n  const url = `${baseUrl}?${op}=${value}`;\n  const posts = await fetch(url);\n  const total = parseInt(posts.headers.get(\"x-wp-total\"), 10);\n  const totalPages = parseInt(posts.headers.get(\"x-wp-totalpages\"), 10);\n  const postsJson = await posts.json();\n  res.setHeader(\"Cache-Control\", \"s-maxage=10, stale-while-revalidate\");\n  res.json({\n    date: new Date().toUTCString(),\n    posts: postsJson,\n    total: total,\n    totalPages: totalPages\n  });\n}\n\nexport default posts;","map":{"version":3,"sources":["/Users/diogocezar/studies/nextjs/pages/api/posts.ts"],"names":["Cors","init","middleware","req","res","Promise","resolve","reject","result","Error","cors","methods","posts","page","slug","query","op","value","baseUrl","url","fetch","total","parseInt","headers","get","totalPages","postsJson","json","setHeader","date","Date","toUTCString"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,MAAjB;;AAEA,MAAMC,IAAI,GAAIC,UAAD,IAAgB;AAC3B,SAAO,CAACC,GAAD,EAAMC,GAAN,KACL,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC/BL,IAAAA,UAAU,CAACC,GAAD,EAAMC,GAAN,EAAYI,MAAD,IAAY;AAC/B,UAAIA,MAAM,YAAYC,KAAtB,EAA6B;AAC3B,eAAOF,MAAM,CAACC,MAAD,CAAb;AACD;;AACD,aAAOF,OAAO,CAACE,MAAD,CAAd;AACD,KALS,CAAV;AAMD,GAPD,CADF;AASD,CAVD;;AAYA,MAAME,IAAI,GAAGT,IAAI,CACfD,IAAI,CAAC;AACHW,EAAAA,OAAO,EAAE,CAAC,KAAD,EAAQ,MAAR,EAAgB,SAAhB;AADN,CAAD,CADW,CAAjB;;AAMA,eAAeC,KAAf,CAAqBT,GAArB,EAA0BC,GAA1B,EAA+B;AAC7B,QAAMM,IAAI,CAACP,GAAD,EAAMC,GAAN,CAAV;AACA,QAAM;AAAES,IAAAA,IAAI,GAAG,CAAT;AAAYC,IAAAA,IAAI,GAAG;AAAnB,MAA4BX,GAAG,CAACY,KAAtC;AACA,MAAIC,EAAE,GAAG,IAAT;AACA,MAAIC,KAAK,GAAG,IAAZ;;AACA,MAAIH,IAAJ,EAAU;AACRE,IAAAA,EAAE,GAAG,MAAL;AACAC,IAAAA,KAAK,GAAGH,IAAR;AACD,GAHD,MAGO;AACLE,IAAAA,EAAE,GAAG,MAAL;AACAC,IAAAA,KAAK,GAAGJ,IAAR;AACD;;AACD,QAAMK,OAAO,GAAG,gDAAhB;AACA,QAAMC,GAAG,GAAI,GAAED,OAAQ,IAAGF,EAAG,IAAGC,KAAM,EAAtC;AACA,QAAML,KAAK,GAAG,MAAMQ,KAAK,CAACD,GAAD,CAAzB;AACA,QAAME,KAAK,GAAGC,QAAQ,CAACV,KAAK,CAACW,OAAN,CAAcC,GAAd,CAAkB,YAAlB,CAAD,EAAkC,EAAlC,CAAtB;AACA,QAAMC,UAAU,GAAGH,QAAQ,CAACV,KAAK,CAACW,OAAN,CAAcC,GAAd,CAAkB,iBAAlB,CAAD,EAAuC,EAAvC,CAA3B;AACA,QAAME,SAAS,GAAG,MAAMd,KAAK,CAACe,IAAN,EAAxB;AACAvB,EAAAA,GAAG,CAACwB,SAAJ,CAAc,eAAd,EAA+B,qCAA/B;AACAxB,EAAAA,GAAG,CAACuB,IAAJ,CAAS;AACPE,IAAAA,IAAI,EAAE,IAAIC,IAAJ,GAAWC,WAAX,EADC;AAEPnB,IAAAA,KAAK,EAAEc,SAFA;AAGPL,IAAAA,KAAK,EAAEA,KAHA;AAIPI,IAAAA,UAAU,EAAEA;AAJL,GAAT;AAMD;;AAED,eAAeb,KAAf","sourcesContent":["import Cors from \"cors\";\n\nconst init = (middleware) => {\n  return (req, res) =>\n    new Promise((resolve, reject) => {\n      middleware(req, res, (result) => {\n        if (result instanceof Error) {\n          return reject(result);\n        }\n        return resolve(result);\n      });\n    });\n};\n\nconst cors = init(\n  Cors({\n    methods: [\"GET\", \"POST\", \"OPTIONS\"],\n  })\n);\n\nasync function posts(req, res) {\n  await cors(req, res);\n  const { page = 1, slug = null } = req.query;\n  let op = null;\n  let value = null;\n  if (slug) {\n    op = \"slug\";\n    value = slug;\n  } else {\n    op = \"page\";\n    value = page;\n  }\n  const baseUrl = \"https://www.diogocezar.com/wp-json/wp/v2/posts\";\n  const url = `${baseUrl}?${op}=${value}`;\n  const posts = await fetch(url);\n  const total = parseInt(posts.headers.get(\"x-wp-total\"), 10);\n  const totalPages = parseInt(posts.headers.get(\"x-wp-totalpages\"), 10);\n  const postsJson = await posts.json();\n  res.setHeader(\"Cache-Control\", \"s-maxage=10, stale-while-revalidate\");\n  res.json({\n    date: new Date().toUTCString(),\n    posts: postsJson,\n    total: total,\n    totalPages: totalPages,\n  });\n}\n\nexport default posts;\n"]},"metadata":{},"sourceType":"module"}